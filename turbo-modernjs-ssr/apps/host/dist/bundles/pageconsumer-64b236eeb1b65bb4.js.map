{"version":3,"file":"pageconsumer-64b236eeb1b65bb4.js","sources":["F:/codespace/mf-arc-test/modernjs-ssr/node_modules/.pnpm/@module-federation+modern-js@0.6.10_react-dom@18.3.1_react@18.3.1__react@18.3.1_typescript@4.9.5_webpack@5.95.0/node_modules/@module-federation/modern-js/dist/esm/runtime/createRemoteSSRComponent.js","F:/codespace/mf-arc-test/modernjs-ssr/node_modules/.pnpm/@module-federation+modern-js@0.6.10_react-dom@18.3.1_react@18.3.1__react@18.3.1_typescript@4.9.5_webpack@5.95.0/node_modules/@module-federation/modern-js/dist/esm/runtime/index.js","F:/codespace/mf-arc-test/modernjs-ssr/node_modules/.pnpm/@module-federation+runtime-tools@0.6.10/node_modules/@module-federation/runtime-tools/dist/runtime.cjs.js","F:/codespace/mf-arc-test/modernjs-ssr/node_modules/.pnpm/react-error-boundary@4.0.13_react@18.3.1/node_modules/react-error-boundary/dist/react-error-boundary.development.esm.js","F:/codespace/mf-arc-test/modernjs-ssr/apps/host/src/components/dynamic-remote.tsx","F:/codespace/mf-arc-test/modernjs-ssr/apps/host/src/routes/page.tsx","F:/codespace/mf-arc-test/modernjs-ssr/apps/host/src/routes/index.css","F:/codespace/mf-arc-test/modernjs-ssr/node_modules/.pnpm/@module-federation+enhanced@0.6.10_react-dom@18.3.1_react@18.3.1__react@18.3.1_typescript@4.9.5_webpack@5.95.0/node_modules/@module-federation/enhanced/dist/src/runtime.js"],"sourcesContent":["import { _ as _async_to_generator } from \"@swc/helpers/_/_async_to_generator\";\nimport { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _to_consumable_array } from \"@swc/helpers/_/_to_consumable_array\";\nimport { _ as _ts_generator } from \"@swc/helpers/_/_ts_generator\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport React from \"react\";\nimport { getInstance } from \"@module-federation/enhanced/runtime\";\nimport { ErrorBoundary } from \"react-error-boundary\";\nfunction getLoadedRemoteInfos(instance, id) {\n  var _ref = instance.remoteHandler.idToRemoteMap[id] || {}, name = _ref.name, expose = _ref.expose;\n  if (!name) {\n    return;\n  }\n  var module = instance.moduleCache.get(name);\n  if (!module) {\n    return;\n  }\n  var remoteSnapshot = instance.snapshotHandler.getGlobalRemoteInfo(module.remoteInfo).remoteSnapshot;\n  return _object_spread_props(_object_spread({}, module.remoteInfo), {\n    snapshot: remoteSnapshot,\n    expose\n  });\n}\nfunction getTargetModuleInfo(id) {\n  var instance = getInstance();\n  if (!instance) {\n    return;\n  }\n  var loadedRemoteInfo = getLoadedRemoteInfos(instance, id);\n  if (!loadedRemoteInfo) {\n    return;\n  }\n  var snapshot = loadedRemoteInfo.snapshot;\n  if (!snapshot) {\n    return;\n  }\n  var publicPath = \"publicPath\" in snapshot ? snapshot.publicPath : \"getPublicPath\" in snapshot ? new Function(snapshot.getPublicPath)() : \"\";\n  if (!publicPath) {\n    return;\n  }\n  var modules = \"modules\" in snapshot ? snapshot.modules : [];\n  var targetModule = modules.find(function(m) {\n    return m.modulePath === loadedRemoteInfo.expose;\n  });\n  if (!targetModule) {\n    return;\n  }\n  var remoteEntry = \"remoteEntry\" in snapshot ? snapshot.remoteEntry : \"\";\n  if (!remoteEntry) {\n    return;\n  }\n  return {\n    module: targetModule,\n    publicPath,\n    remoteEntry\n  };\n}\nfunction collectSSRAssets(options) {\n  var _ref = typeof options === \"string\" ? {\n    id: options\n  } : options, id = _ref.id, _ref_injectLink = _ref.injectLink, injectLink = _ref_injectLink === void 0 ? true : _ref_injectLink, _ref_injectScript = _ref.injectScript, injectScript = _ref_injectScript === void 0 ? true : _ref_injectScript;\n  var links = [];\n  var scripts = [];\n  var instance = getInstance();\n  if (!instance || !injectLink && !injectScript) {\n    return _to_consumable_array(scripts).concat(_to_consumable_array(links));\n  }\n  var moduleAndPublicPath = getTargetModuleInfo(id);\n  if (!moduleAndPublicPath) {\n    return _to_consumable_array(scripts).concat(_to_consumable_array(links));\n  }\n  var targetModule = moduleAndPublicPath.module, publicPath = moduleAndPublicPath.publicPath, remoteEntry = moduleAndPublicPath.remoteEntry;\n  if (injectLink) {\n    _to_consumable_array(targetModule.assets.css.sync).concat(_to_consumable_array(targetModule.assets.css.async)).forEach(function(file, index) {\n      links.push(/* @__PURE__ */ _jsx(\"link\", {\n        href: \"\".concat(publicPath).concat(file),\n        rel: \"stylesheet\",\n        type: \"text/css\"\n      }, \"\".concat(file.split(\".\")[0], \"_\").concat(index)));\n    });\n  }\n  if (injectScript) {\n    scripts.push(/* @__PURE__ */ _jsx(\"script\", {\n      async: true,\n      src: \"\".concat(publicPath).concat(remoteEntry),\n      crossOrigin: \"anonymous\"\n    }, remoteEntry.split(\".\")[0]));\n    _to_consumable_array(targetModule.assets.js.sync).forEach(function(file, index) {\n      scripts.push(/* @__PURE__ */ _jsx(\"script\", {\n        async: true,\n        src: \"\".concat(publicPath).concat(file),\n        crossOrigin: \"anonymous\"\n      }, \"\".concat(file.split(\".\")[0], \"_\").concat(index)));\n    });\n  }\n  return _to_consumable_array(scripts).concat(_to_consumable_array(links));\n}\nfunction createRemoteSSRComponent(info) {\n  return function(props) {\n    var exportName = (info === null || info === void 0 ? void 0 : info.export) || \"default\";\n    var LazyComponent = /* @__PURE__ */ React.lazy(/* @__PURE__ */ _async_to_generator(function() {\n      var m, moduleId, assets, Com, err, FallbackFunctionComponent, FallbackNode;\n      return _ts_generator(this, function(_state) {\n        switch (_state.label) {\n          case 0:\n            _state.trys.push([\n              0,\n              2,\n              ,\n              3\n            ]);\n            return [\n              4,\n              info.loader()\n            ];\n          case 1:\n            m = _state.sent();\n            if (!m) {\n              throw new Error(\"load remote failed\");\n            }\n            moduleId = m && m[Symbol.for(\"mf_module_id\")];\n            assets = collectSSRAssets({\n              id: moduleId\n            });\n            Com = m[exportName];\n            if (exportName in m && typeof Com === \"function\") {\n              return [\n                2,\n                {\n                  default: function() {\n                    return /* @__PURE__ */ _jsxs(_Fragment, {\n                      children: [\n                        assets,\n                        /* @__PURE__ */ _jsx(Com, _object_spread({}, props))\n                      ]\n                    });\n                  }\n                }\n              ];\n            } else {\n              throw Error(\"Make sure that \".concat(moduleId, \" has the correct export when export is \").concat(String(exportName)));\n            }\n            return [\n              3,\n              3\n            ];\n          case 2:\n            err = _state.sent();\n            if (!info.fallback) {\n              throw err;\n            }\n            FallbackFunctionComponent = info.fallback;\n            FallbackNode = /* @__PURE__ */ _jsx(FallbackFunctionComponent, {\n              error: err,\n              resetErrorBoundary: function() {\n                console.log('SSR mode not support \"resetErrorBoundary\" !');\n              }\n            });\n            return [\n              2,\n              {\n                default: function() {\n                  return FallbackNode;\n                }\n              }\n            ];\n          case 3:\n            return [\n              2\n            ];\n        }\n      });\n    }));\n    return /* @__PURE__ */ _jsx(ErrorBoundary, {\n      FallbackComponent: info.fallback,\n      children: /* @__PURE__ */ _jsx(React.Suspense, {\n        fallback: info.loading,\n        children: /* @__PURE__ */ _jsx(LazyComponent, {})\n      })\n    });\n  };\n}\nexport {\n  collectSSRAssets,\n  createRemoteSSRComponent\n};\n","export * from \"@module-federation/enhanced/runtime\";\nimport { createRemoteSSRComponent } from \"./createRemoteSSRComponent\";\nexport {\n  createRemoteSSRComponent\n};\n","'use strict';\n\nvar runtime = require('@module-federation/runtime');\n\n\n\nObject.keys(runtime).forEach(function (k) {\n\tif (k !== 'default' && !Object.prototype.hasOwnProperty.call(exports, k)) Object.defineProperty(exports, k, {\n\t\tenumerable: true,\n\t\tget: function () { return runtime[k]; }\n\t});\n});\n","'use client';\nimport { createContext, Component, createElement, isValidElement, useContext, useState, useMemo, forwardRef } from 'react';\n\nconst ErrorBoundaryContext = createContext(null);\n\nconst initialState = {\n  didCatch: false,\n  error: null\n};\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.resetErrorBoundary = this.resetErrorBoundary.bind(this);\n    this.state = initialState;\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      didCatch: true,\n      error\n    };\n  }\n  resetErrorBoundary() {\n    const {\n      error\n    } = this.state;\n    if (error !== null) {\n      var _this$props$onReset, _this$props;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      (_this$props$onReset = (_this$props = this.props).onReset) === null || _this$props$onReset === void 0 ? void 0 : _this$props$onReset.call(_this$props, {\n        args,\n        reason: \"imperative-api\"\n      });\n      this.setState(initialState);\n    }\n  }\n  componentDidCatch(error, info) {\n    var _this$props$onError, _this$props2;\n    (_this$props$onError = (_this$props2 = this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props2, error, info);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const {\n      didCatch\n    } = this.state;\n    const {\n      resetKeys\n    } = this.props;\n\n    // There's an edge case where if the thing that triggered the error happens to *also* be in the resetKeys array,\n    // we'd end up resetting the error boundary immediately.\n    // This would likely trigger a second error to be thrown.\n    // So we make sure that we don't check the resetKeys on the first call of cDU after the error is set.\n\n    if (didCatch && prevState.error !== null && hasArrayChanged(prevProps.resetKeys, resetKeys)) {\n      var _this$props$onReset2, _this$props3;\n      (_this$props$onReset2 = (_this$props3 = this.props).onReset) === null || _this$props$onReset2 === void 0 ? void 0 : _this$props$onReset2.call(_this$props3, {\n        next: resetKeys,\n        prev: prevProps.resetKeys,\n        reason: \"keys\"\n      });\n      this.setState(initialState);\n    }\n  }\n  render() {\n    const {\n      children,\n      fallbackRender,\n      FallbackComponent,\n      fallback\n    } = this.props;\n    const {\n      didCatch,\n      error\n    } = this.state;\n    let childToRender = children;\n    if (didCatch) {\n      const props = {\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      };\n      if (typeof fallbackRender === \"function\") {\n        childToRender = fallbackRender(props);\n      } else if (FallbackComponent) {\n        childToRender = createElement(FallbackComponent, props);\n      } else if (fallback === null || isValidElement(fallback)) {\n        childToRender = fallback;\n      } else {\n        {\n          console.error(\"react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop\");\n        }\n        throw error;\n      }\n    }\n    return createElement(ErrorBoundaryContext.Provider, {\n      value: {\n        didCatch,\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      }\n    }, childToRender);\n  }\n}\nfunction hasArrayChanged() {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return a.length !== b.length || a.some((item, index) => !Object.is(item, b[index]));\n}\n\nfunction assertErrorBoundaryContext(value) {\n  if (value == null || typeof value.didCatch !== \"boolean\" || typeof value.resetErrorBoundary !== \"function\") {\n    throw new Error(\"ErrorBoundaryContext not found\");\n  }\n}\n\nfunction useErrorBoundary() {\n  const context = useContext(ErrorBoundaryContext);\n  assertErrorBoundaryContext(context);\n  const [state, setState] = useState({\n    error: null,\n    hasError: false\n  });\n  const memoized = useMemo(() => ({\n    resetBoundary: () => {\n      context.resetErrorBoundary();\n      setState({\n        error: null,\n        hasError: false\n      });\n    },\n    showBoundary: error => setState({\n      error,\n      hasError: true\n    })\n  }), [context.resetErrorBoundary]);\n  if (state.hasError) {\n    throw state.error;\n  }\n  return memoized;\n}\n\nfunction withErrorBoundary(component, errorBoundaryProps) {\n  const Wrapped = forwardRef((props, ref) => createElement(ErrorBoundary, errorBoundaryProps, createElement(component, {\n    ...props,\n    ref\n  })));\n\n  // Format for display in DevTools\n  const name = component.displayName || component.name || \"Unknown\";\n  Wrapped.displayName = \"withErrorBoundary(\".concat(name, \")\");\n  return Wrapped;\n}\n\nexport { ErrorBoundary, ErrorBoundaryContext, useErrorBoundary, withErrorBoundary };\n","import { createRemoteSSRComponent, loadRemote, registerRemotes } from '@modern-js/runtime/mf';\r\n\r\nregisterRemotes([\r\n    {\r\n        name: 'dynamic_provider',\r\n        entry: 'http://localhost:3008/mf-manifest.json',\r\n    }\r\n])\r\n\r\nexport const DynamicRemoteSSRComponents = createRemoteSSRComponent({\r\n    loader: () => loadRemote('dynamic_provider/Image'),\r\n    loading: 'loading...',\r\n    fallback: ({ error }) => {\r\n        if (error instanceof Error && error.message.includes('not exist')) {\r\n            return <div>fallback - not existed id</div>;\r\n        }\r\n        return <div>fallback</div>;\r\n    },\r\n});\r\n","import { createRemoteSSRComponent } from '@modern-js/runtime/mf';\r\nimport {DynamicRemoteSSRComponents } from '../components/dynamic-remote'\r\nimport './index.css';\r\n\r\nconst RemoteSSRComponent = createRemoteSSRComponent({\r\n  loader: () => import('remote/Image'),\r\n  loading: 'loading...',\r\n  export: 'default',\r\n  fallback: ({ error }) => {\r\n    if (error instanceof Error && error.message.includes('not exist')) {\r\n      return <div>fallback - not existed id</div>;\r\n    }\r\n    return <div>fallback</div>;\r\n  },\r\n});\r\n\r\n\r\n\r\nconst Index = () => {\r\n  return (\r\n    <div className=\"container-box\">\r\n      <RemoteSSRComponent />\r\n      <DynamicRemoteSSRComponents />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Index;\r\n",null,"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"@module-federation/runtime-tools/runtime\"), exports);\n//# sourceMappingURL=runtime.js.map"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;;;;;;;;;;;;;;;;;AC1LA;AACA;AAGA;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzJA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;AACA;AACA;AAAA;;;;;;AACA;AACA;;;;;;;;;;;;;;;;AClBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;AACA;AACA;AAAA;;;;;;AACA;AACA;AAIA;AACA;AACA;;AACA;;;;;AACA;;;;;;;;;;;AAGA;AAEA;;;;;;;;;;AE3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}